{% extends "base.html" %}
{% set active_page = "documents" %}
{% from 'macros/fields.html' import render_field %}

{% block content %}
  <div class="row">
    <div class="col-xs-12">
      <h2>Document '{{ document.name }}'</h2>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-8">
      <h3>Contents</h3>
      {% macro content_pager(doc, files, curr_page) -%}
        <nav>
          <ul class="pager">
            <li class="previous{% if not files.has_prev %} disabled{% endif %}">
              <a href="{{ url_for('single_document', id=doc.id, curr_file=files.prev_num) }}">
                <span aria-hidden="true">&larr;</span> Older
              </a>
            </li>
            <li class="next{% if not files.has_next %} disabled{% endif %}">
              <a href="{{ url_for('single_document', id=doc.id, curr_file=files.next_num) }}">
                Newer <span aria-hidden="true">&rarr;</span>
              </a>
            </li>
          </ul>
        </nav>
      {%- endmacro %}

      {% if document_files.total > 1 %}
        {{ content_pager(document, document_files, curr_file) }}
      {% endif %}

      <img src="{{ url_for('file_data', id=document_files.items[0].id) }}"
           style="max-width: 100%"/>

      {% if document_files.total > 1 %}
        {{ content_pager(document, document_files, curr_file) }}
      {% endif %}
    </div>

    <div class="col-xs-4">
      <h3>Metadata</h3>
      <table class="table">
        <thead>
          <th>Name</th>
          <th>Value</th>
        </thead>
        <tbody>
          <tr>
            <td>Created</td>
            <td>{{ momentjs(document.created).calendar() }}</td>
          </tr>
        </tbody>
      </table>

      <h3>Tags</h3>
      <table class="table">
        <tbody>
          {% for tag in document.tags %}
            <tr>
              <td>
                <a href="{{ url_for('single_tag', id=tag.id) }}">
                  {{ tag.name }}
                </a>
              </td>
              <td>
                <button type="button" class="btn btn-danger btn-xs">
                  <span class="glyphicon glyphicon-trash"></span>
                </button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Actions</h3>

      <div role="tabpanel">
        <ul id="actionsTabs" class="nav nav-tabs" role="tablist" style="margin-bottom: 15px">
          <li role="presentation" class="active">
            <a href="#tags" role="tab" data-toggle="tab">Add Tags</a>
          </li>
          <li role="presentation">
            <a href="#upload" role="tab" data-toggle="tab">Upload File</a>
          </li>
          <li role="presentation">
            <a href="#scan" role="tab" data-toggle="tab">Scan File</a>
          </li>
        </ul>

        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="tags">
            <form action="{{ url_for('single_document_tags', id=document.id) }}"
                  method="POST"
                  enctype="multipart/form-data"
                  class="form-inline"
                  role="form">
              {{ add_tags_form.hidden_tag() }}
              {{ render_field(add_tags_form.tags, label_visible=False, placeholder='Enter space-seperated tags') }}
              {{ add_tags_form.add(class_="btn btn-primary") }}
            </form>
          </div>

          <div role="tabpanel" class="tab-pane" id="upload">
            <form action="{{ url_for('single_document_files', id=document.id) }}"
                  method="POST"
                  enctype="multipart/form-data"
                  class="form"
                  role="form">
              {{ upload_form.hidden_tag() }}
              {{ render_field(upload_form.file, label_visible=False) }}
              {{ upload_form.upload(class_="btn btn-primary") }}
            </form>
          </div>

          <div role="tabpanel" class="tab-pane" id="scan">
            {% if have_scanner %}
              <form action="{{ url_for('single_document_scan', id=document.id) }}"
                    method="POST"
                    enctype="multipart/form-data"
                    class="form"
                    role="form">
                {{ scan_form.hidden_tag() }}
                {{ render_field(scan_form.scanner_name, label_visible=True) }}
                {{ scan_form.scan(class_="btn btn-primary") }}
              </form>
            {% else %}
              <p><strong>No scanners available</strong></p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
